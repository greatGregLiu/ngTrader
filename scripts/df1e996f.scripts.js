"use strict";var app=angular.module("ngTraderApp",["ngCookies","ngResource","ngSanitize","ngRoute","jmdobry.angular-cache"]);app.config(["$routeProvider","$angularCacheFactoryProvider",function(a,b){a.when("/",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/game",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/nav",{templateUrl:"components/nav/nav.tmpl.html",controller:"navCtrl"}).otherwise({redirectTo:"/"}),b.setCacheDefaults({storageMode:"localStorage"})}]),app.controller("gameCtrl",["$scope","commoditySrvc","citySrvc","accountSrvc",function(a,b,c,d){b.updatePrices(),a.commodities=b.all,a.account=d,a.cities=c.all,a.goToCity=function(a){b.updatePrices(),d.currentCity=a,d.daysLeft-=1,1===d.daysLeft?d.showLastDayMessage=!0:0===d.daysLeft&&d.gameOver()},a.buyItem=function(c,e){b.buyCommodity(c,e),a.account=d},a.sellItem=function(c){b.sellCommodity(c),a.account=d},a.setMarketHoverItem=function(b){a.marketHoverItem=b.name},a.resetMarketHoverItem=function(){a.marketHoverItem=""},a.resetHighScores=function(){d.resetHighScores()},a.convertToDollars=function(a){return a/100}}]),app.controller("navCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),app.service("commoditySrvc",["accountSrvc","$filter",function(a,b){function c(){d.forEach(function(b){b.maxQuantityPurchasable=Math.floor(a.currentCash/b.currentPrice)})}var d=[{name:"Absinthe",basePrice:51100,purchasedItems:[]},{name:"Cognac",basePrice:25600,purchasedItems:[]},{name:"Gin",basePrice:3200,purchasedItems:[]},{name:"Mezcal",basePrice:12800,purchasedItems:[]},{name:"Rum",basePrice:1600,purchasedItems:[]},{name:"Tequila",basePrice:800,purchasedItems:[]},{name:"Vodka",basePrice:400,purchasedItems:[]},{name:"Whiskey",basePrice:6400,purchasedItems:[]},{name:"Beer",basePrice:200,purchasedItems:[]},{name:"Wine",basePrice:102400,purchasedItems:[]}],e={normalRange:20,specialRange:20},f={all:d,updatePrices:function(){var b,c,f=d[Math.floor(Math.random()*d.length)];a.netWorth=a.currentCash,d.forEach(function(d){d.priceHigh=!1,d.special=!1,d.priceChanged=!0,b=e.normalRange,d.name===f.name&&(b+=e.specialRange,d.special=!0),c=Math.floor(2*Math.random()*b)-b,c>0&&(d.priceHigh=!0),0===c&&(d.priceChanged=!1),d.currentPrice=d.basePrice*(c/100)+d.basePrice,d.maxQuantityPurchasable=Math.floor(a.currentCash/d.currentPrice),d.purchasedItems.forEach(function(b){a.netWorth+=b.quantity*d.currentPrice})})},buyCommodity:function(e,f){var g=b("filter")(d,e.name,!0)[0],h=e.currentPrice*f;if(a.currentCash>=h){a.currentCash-=h;var i={name:e.name,purchasePrice:e.currentPrice,marketPrice:e.currentPrice,quantity:f};c(),g.purchasedItems.push(i)}},sellCommodity:function(e){var f,g,h=b("filter")(d,e.name,!0)[0];h&&(f={itemName:e.name,profitEach:h.currentPrice-e.purchasePrice,profitTotal:(h.currentPrice-e.purchasePrice)*e.quantity,purchasePrice:e.purchasePrice,sellPrice:h.currentPrice,quantity:e.quantity},g=b("filter")(d,e.name,!0)[0],h.purchasedItems.splice(h.purchasedItems.indexOf(e),1),a.transactions.push(f),a.currentCash+=h.currentPrice*e.quantity),c()}};return f}]),app.service("citySrvc",function(){var a=[{name:"Chicago"},{name:"New York"},{name:"Los Angeles"},{name:"Denver"},{name:"Detroit"},{name:"Miami"}],b={all:a};return b}),app.service("accountSrvc",["citySrvc","$angularCacheFactory",function(a,b){var c=b("cache"),d={daysLeft:30,inventory:[],transactions:[],currentCash:1e4,netWorth:0,currentCity:"",highScores:[],showLastDayMessage:!1,gameOver:function(){this.highScores.push({score:this.currentCash}),c.put("highScores",this.highScores),this.currentCash=1e4,this.daysLeft=30,this.inventory=[],this.transactions=[],this.showLastDayMessage=!1},resetHighScores:function(){c.remove("highScores"),this.highScores=[]}};return d.highScores=c.get("highScores")||[],d.currentCity||(d.currentCity=a.all[Math.floor(Math.random()*a.all.length)]),d}]);