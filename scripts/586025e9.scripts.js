goog.provide("ngTrader.commodity"),ngTrader.commodity=angular.module("ngTrader.commodity",[]),goog.provide("ngTrader.commodity.commoditySrvc"),ngTrader.commodity.commoditySrvc=function(a,b,c){this.accountSrvc=a,this.$filter=c,this.citySrvc=b,this.commodities=[{name:"Absinthe",basePrice:51200,purchasedItems:[]},{name:"Cognac",basePrice:25600,purchasedItems:[]},{name:"Gin",basePrice:3200,purchasedItems:[]},{name:"Mezcal",basePrice:12800,purchasedItems:[]},{name:"Rum",basePrice:1600,purchasedItems:[]},{name:"Tequila",basePrice:800,purchasedItems:[]},{name:"Vodka",basePrice:400,purchasedItems:[]},{name:"Whiskey",basePrice:6400,purchasedItems:[]},{name:"Beer",basePrice:200,purchasedItems:[]},{name:"Wine",basePrice:102400,purchasedItems:[]}],this.priceModification={normalRange:20,specialRange:20,citySpecialtyRange:10}},ngTrader.commodity.commoditySrvc.prototype.updateMaxQuantityPurchasable=function(){var a=this;this.commodities.forEach(function(b){b.maxQuantityPurchasable=Math.floor(a.accountSrvc.currentCash/b.currentPrice)})},ngTrader.commodity.commoditySrvc.prototype.setCitySpecialty=function(){var a=this,b=a.commodities.slice();a.citySrvc.cities.forEach(function(a){var c=Math.floor(Math.random()*b.length),d=b[c];a.specialtyItem=d,b.splice(c,1)})},ngTrader.commodity.commoditySrvc.prototype.updatePrices=function(){var a,b,c=this.commodities[Math.floor(Math.random()*this.commodities.length)],d=this;this.accountSrvc.netWorth=this.accountSrvc.currentCash,this.commodities.forEach(function(e){e.priceHigh=!1,e.dailySpecial=!1,e.citySpecialty=!1,e.priceChanged=!0,a=d.priceModification.normalRange,e.name===c.name&&(a+=d.priceModification.specialRange,e.dailySpecial=!0),e.name===d.citySrvc.currentCity.specialtyItem.name&&(a+=d.priceModification.citySpecialtyRange,e.citySpecialty=!0),b=Math.floor(2*Math.random()*a)-a,b>0&&(e.priceHigh=!0),0===b&&(e.priceChanged=!1),e.currentPrice=e.basePrice*(b/100)+e.basePrice,e.maxQuantityPurchasable=Math.floor(d.accountSrvc.currentCash/e.currentPrice),e.purchasedItems.forEach(function(a){d.accountSrvc.netWorth+=a.quantity*e.currentPrice})})},ngTrader.commodity.commoditySrvc.prototype.buyCommodity=function(a,b){var c=this.$filter("filter")(this.commodities,a.name,!0)[0],d=a.currentPrice*b;if(this.accountSrvc.currentCash>=d){this.accountSrvc.currentCash-=d;var e={name:a.name,purchasePrice:a.currentPrice,marketPrice:a.currentPrice,quantity:b};this.updateMaxQuantityPurchasable(),c.purchasedItems.push(e)}},ngTrader.commodity.commoditySrvc.prototype.sellCommodity=function(a){var b,c,d,e=this.$filter("filter")(this.commodities,a.name,!0)[0];e&&(b={itemName:a.name,profitEach:e.currentPrice-a.purchasePrice,profitTotal:(e.currentPrice-a.purchasePrice)*a.quantity,purchasePrice:a.purchasePrice,sellPrice:e.currentPrice,quantity:a.quantity},c=this.$filter("filter")(this.commodities,a.name,!0)[0],e.purchasedItems.splice(e.purchasedItems.indexOf(a),1),this.accountSrvc.transactions.push(b),this.accountSrvc.currentCash+=e.currentPrice*a.quantity,d=this.$filter("filter")(this.accountSrvc.transactions,a.name,!0),e.averageSellPrice=d.reduce(function(a,b){return a+b.sellPrice},0)/d.length),this.updateMaxQuantityPurchasable()},ngTrader.commodity.commoditySrvc.prototype.reset=function(){this.commodities.forEach(function(a){a.averageSellPrice=0,a.purchasedItems=[]}),this.updatePrices(),this.updateMaxQuantityPurchasable(),this.setCitySpecialty()},ngTrader.commodity.commoditySrvc.$inject=["accountSrvc","citySrvc","$filter"],ngTrader.commodity.service("commoditySrvc",ngTrader.commodity.commoditySrvc),goog.provide("ngTrader.account"),ngTrader.account=angular.module("ngTrader.account",[]),goog.provide("ngTrader.account.accountSrvc"),ngTrader.account.accountSrvc=function(){this.transactions=[],this.currentCash=1e4,this.netWorth=0},ngTrader.account.accountSrvc.prototype.reset=function(){this.currentCash=1e4,this.transactions=[],this.netWorth=1e4},ngTrader.account.service("accountSrvc",ngTrader.account.accountSrvc),goog.provide("ngTrader.city"),ngTrader.city=angular.module("ngTrader.city",[]),goog.provide("ngTrader.city.citySrvc"),ngTrader.city.citySrvc=function(){this.cities=[{name:"Chicago"},{name:"New York"},{name:"Huston"},{name:"Denver"},{name:"Detroit"},{name:"Miami"}],this.currentCity=null},ngTrader.city.citySrvc.prototype.getRandomCity=function(){this.currentCity=this.cities[Math.floor(Math.random()*this.cities.length)]},ngTrader.city.citySrvc.prototype.setCurrentCity=function(a){this.currentCity=a},ngTrader.city.service("citySrvc",ngTrader.city.citySrvc),goog.provide("ngTrader.common"),ngTrader.common=angular.module("ngTrader.common",[]),goog.provide("ngTrader.common.toDollarDrtv"),ngTrader.common.toDollarDrtv=function(){return{restrict:"AE",scope:{cents:"="},template:"{{ cents/100 | currency }}"}},ngTrader.common.directive("toDollar",ngTrader.common.toDollarDrtv),goog.provide("ngTrader.common.toDollarFltr"),ngTrader.common.toDollarFltr=function(a){return function(b){if("number"==typeof b){var c=b/100;return a("currency")(c)}return b}},ngTrader.common.toDollarFltr.$inject=["$filter"],ngTrader.common.filter("toDollar",ngTrader.common.toDollarFltr),goog.provide("ngTrader.common.autoActive"),ngTrader.common.autoActive=function(a){return{restrict:"A",scope:!1,link:function(b,c){function d(){var b=a.path();b&&angular.forEach(c.find("li"),function(a){var c=a.querySelector("a");c.href.match("#"+b+"(?=\\?|$)")?angular.element(a).addClass("active"):angular.element(a).removeClass("active")})}d(),b.$on("$locationChangeSuccess",d)}}},ngTrader.common.autoActive.$inject=["$location"],ngTrader.common.directive("autoActive",ngTrader.common.autoActive),goog.provide("ngTrader.game"),ngTrader.game=angular.module("ngTrader.game",[]),goog.provide("ngTrader.game.gameSrvc"),ngTrader.game.gameSrvc=function(a,b,c){this.daysLeft=30,this.lastDay=!1,this.highScoreSrvc=a,this.accountSrvc=b,this.commoditySrvc=c,this.initialLoad=!0},ngTrader.game.gameSrvc.prototype.reduceDaysLeft=function(){this.daysLeft-=1,1===this.daysLeft&&(this.lastDay=!0)},ngTrader.game.gameSrvc.prototype.gameOver=function(a){a||this.highScoreSrvc.add({score:this.accountSrvc.currentCash,datetime:(new Date).getTime()}),this.accountSrvc.reset(),this.commoditySrvc.reset(),this.daysLeft=30,this.lastDay=!1},ngTrader.game.gameSrvc.$inject=["highScoreSrvc","accountSrvc","commoditySrvc"],ngTrader.game.service("gameSrvc",ngTrader.game.gameSrvc),goog.provide("ngTrader.game.gameCtrl"),ngTrader.game.gameCtrl=function(a,b,c,d,e,f,g){this.gameSrvc=e,this.commoditySrvc=b,this.citySrvc=c,this.accountSrvc=d,this.tutorialOptions=f.options,this.$modal=g,this.$scope=a,c.currentCity||(b.setCitySpecialty(),c.getRandomCity(),b.updatePrices()),e.initialLoad&&(this.showModal("start"),e.initialLoad=!1)},ngTrader.game.gameCtrl.prototype.submitScore=function(){this.showModal("gameOver",this.accountSrvc.netWorth),this.gameSrvc.gameOver()},ngTrader.game.gameCtrl.prototype.goToCity=function(a){this.citySrvc.setCurrentCity(a),this.commoditySrvc.updatePrices(),this.gameSrvc.reduceDaysLeft()},ngTrader.game.gameCtrl.prototype.buyItem=function(a,b){this.commoditySrvc.buyCommodity(a,b)},ngTrader.game.gameCtrl.prototype.sellItem=function(a){this.commoditySrvc.sellCommodity(a)},ngTrader.game.gameCtrl.prototype.setMarketHoverItem=function(a){this.marketHoverItem=a.name},ngTrader.game.gameCtrl.prototype.resetMarketHoverItem=function(){this.marketHoverItem=""},ngTrader.game.gameCtrl.prototype.isCurrentCity=function(a){return a.name===this.citySrvc.currentCity.name},ngTrader.game.gameCtrl.prototype.getPotentialProfit=function(a){var b="unknown";return a.averageSellPrice&&(b=(a.averageSellPrice-a.currentPrice)*a.maxQuantityPurchasable/100),b},ngTrader.game.gameCtrl.prototype.openMenu=function(){this.showModal("gameMenu")},ngTrader.game.gameCtrl.prototype.showModal=function(a,b){var c,d=this;switch(a){case"start":c="components/game/gameModalStart.tmpl.html";break;case"gameMenu":c="components/game/gameModalGameMenu.tmpl.html";break;case"gameOver":c="components/game/gameModalGameOver.tmpl.html"}var e=this.$modal.open({templateUrl:c,controller:"gameModalInstanceCtrl",size:"sm",resolve:{type:function(){return a},score:function(){return b}}});e.result.then(function(a){switch(a){case"startTutorial":d.$scope.startTutorial();break;case"resetGame":d.gameSrvc.gameOver(!0)}},function(){})},ngTrader.game.gameCtrl.$inject=["$scope","commoditySrvc","citySrvc","accountSrvc","gameSrvc","tutorialSrvc","$modal"],ngTrader.game.controller("gameCtrl",ngTrader.game.gameCtrl),goog.provide("ngTrader.game.gameModalInstanceCtrl"),ngTrader.game.gameModalInstanceCtrl=function(a,b,c,d,e){this.$modalInstance=b,a.type=d,a.score=e,a.highScoreSrvc=c,a.playGame=function(){b.close("playGame")},a.resetGame=function(){b.close("resetGame")},a.startTutorial=function(){b.close("startTutorial")}},ngTrader.game.gameModalInstanceCtrl.$inject=["$scope","$modalInstance","highScoreSrvc","type","score"],ngTrader.game.controller("gameModalInstanceCtrl",ngTrader.game.gameModalInstanceCtrl),goog.provide("ngTrader.highScore"),ngTrader.highScore=angular.module("ngTrader.highScore",[]),goog.provide("ngTrader.highScore.highScoreSrvc"),ngTrader.highScore.highScoreSrvc=function(a,b){this.cache=a("cache"),this.highScores=this.cache.get("highScores")||[],this.$filter=b},ngTrader.highScore.highScoreSrvc.prototype.add=function(a){var b=this.$filter("filter")(this.highScores,{newest:!0},!0)[0];b&&(b.newest=!1),a.newest=!0,this.highScores.push(a),this.cache.put("highScores",this.highScores)},ngTrader.highScore.highScoreSrvc.prototype.reset=function(){this.cache.remove("highScores"),this.highScores=[]},ngTrader.highScore.highScoreSrvc.$inject=["$angularCacheFactory","$filter"],ngTrader.highScore.service("highScoreSrvc",ngTrader.highScore.highScoreSrvc),goog.provide("ngTrader.highScore.highScoreCtrl"),ngTrader.highScore.highScoreCtrl=function(a,b,c){this.highScoreSrvc=a,this.tableParams=new b({page:1,count:10,sorting:{score:"desc"}},{total:a.highScores.length,getData:function(b,d){var e=d.sorting()?c("orderBy")(a.highScores,d.orderBy()):a.highScores;b.resolve(e.slice((d.page()-1)*d.count(),d.page()*d.count()))}})},ngTrader.highScore.highScoreCtrl.prototype.resetHighScores=function(){this.highScores=this.highScoreSrvc.reset()},ngTrader.highScore.highScoreCtrl.$inject=["highScoreSrvc","ngTableParams","$filter"],ngTrader.highScore.controller("highScoreCtrl",ngTrader.highScore.highScoreCtrl),goog.provide("ngTrader.tutorial"),ngTrader.tutorial=angular.module("ngTrader.tutorial",[]),goog.provide("ngTrader.tutorial.tutorialCtrl"),ngTrader.tutorial.tutorialCtrl=function(a){this.options=a.options},ngTrader.tutorial.tutorialCtrl.prototype.endTutorial=function(){console.log("stuff")},ngTrader.tutorial.tutorialCtrl.$inject=["tutorialSrvc"],ngTrader.tutorial.controller("tutorialCtrl",ngTrader.tutorial.tutorialCtrl),goog.provide("ngTrader.tutorial.tutorialSrvc"),ngTrader.tutorial.tutorialSrvc=function(){this.options={steps:[{element:".daysLeft",intro:"<p>Changing cities takes 1 day, game ends after 30 days.</p>"},{element:".currentCash",intro:"<p>Money available to purchase items in a city. When game ends, this will be your score.</p><strong>Inventory does not count, so make sure to sell everthing on the last day.</strong>",position:"left"},{element:".netWorth",intro:"Available cash plus value of inventory given the current city's prices."},{element:".itemCurrentPrice",intro:"Each day the price of an item ranges from <div><strong>-20% to +20%</strong></div> of its base price."},{element:".buyAction",intro:"Number units of an item you can afford to buy.",position:"left"},{element:".sellActions",intro:"This shows how many units you purchased and at what price. Handy reminder when you switch cities."},{element:".fa-arrow-circle-down",intro:'<p><i class="fa fa-arrow-circle-down"></i> price is low, good time to buy.</p><p><i class="fa fa-arrow-circle-up"></i> price is high, good time to sell.</p><p> <i class="fa fa-minus-circle"></i> price is at base, probably not a good time to buy.</p>',position:"right"},{element:".fa-bolt",intro:"City daily special which adds an additional <div><strong>-20% to +20%</strong></div> to the base price range.",position:"right"},{element:".fa-trophy",intro:"Each playthrough cities are assigned an item they specialize in. This adds an additional <div><strong>-10% to +10%</strong></div> to the base price range and stacks with the daily special!"},{element:".cityList",intro:"After you buy an item, go to a different city to try and sell it for a profit"},{element:".citySpecialty",intro:"Below the city name is a hint for what item it specializes in for this playthrough"},{element:".transactions",intro:"This shows a hisotry of all items you have sold. Hover over the market table items to filter the transactions to help to determine historical highs and lows."},{intro:"That's it, you're ready to play the game. You can replay the tutorial from the main navigtion or go to the instructions link for more detailed info",position:"left"}],showStepNumbers:!1,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"<strong>NEXT!</strong>",prevLabel:'<span style="color:green">Previous</span>',skipLabel:"Exit",doneLabel:"Thanks"}},ngTrader.tutorial.service("tutorialSrvc",ngTrader.tutorial.tutorialSrvc),goog.require("ngTrader.account"),goog.require("ngTrader.city"),goog.require("ngTrader.commodity"),goog.require("ngTrader.common"),goog.require("ngTrader.game"),goog.require("ngTrader.highScore"),goog.require("ngTrader.tutorial"),goog.provide("ngTrader.application.module"),ngTrader.application.module=angular.module("ngTrader",["ngCookies","ngResource","ngSanitize","ngRoute","jmdobry.angular-cache","ui.bootstrap","angular-intro","ngTable",ngTrader.account.name,ngTrader.city.name,ngTrader.commodity.name,ngTrader.common.name,ngTrader.game.name,ngTrader.highScore.name,ngTrader.tutorial.name]),ngTrader.application.module.config(["$routeProvider","$angularCacheFactoryProvider",function(a,b){a.when("/",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/game",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/nav",{templateUrl:"components/nav/nav.tmpl.html",controller:"navCtrl"}).when("/highScores",{templateUrl:"components/highScore/highScore.tmpl.html",controller:"highScoreCtrl"}).otherwise({redirectTo:"/"}),b.setCacheDefaults({storageMode:"localStorage"})}]);