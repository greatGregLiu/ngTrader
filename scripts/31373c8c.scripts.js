"use strict";var app=angular.module("ngTraderApp",["ngCookies","ngResource","ngSanitize","ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/game",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/nav",{templateUrl:"components/nav/nav.tmpl.html",controller:"navCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("gameCtrl",["$scope","commoditySrvc","citySrvc","accountSrvc",function(a,b,c,d){b.updatePrices(),a.commodities=b.all,a.account=d,a.cities=c.all,a.goToCity=function(a){b.updatePrices(),d.currentCity=a,d.daysLeft>0?d.daysLeft-=1:d.gameOver()},a.buyItem=function(c,e){b.buyCommodity(c,e),a.account=d},a.sellItem=function(c){b.sellCommodity(c),a.account=d}}]),app.controller("navCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),app.service("commoditySrvc",["accountSrvc","$filter",function(a,b){function c(){e.forEach(function(b){b.maxQuantityPurchasable=Math.floor(a.currentCash/b.currentPrice)})}function d(){a.inventory.forEach(function(a){var c=b("filter")(e,a.name,!0);c.length&&(a.marketPrice=c[0].currentPrice)})}var e=[{name:"Absinthe",minPrice:500,maxPrice:1e3},{name:"Cognac",minPrice:100,maxPrice:200},{name:"Gin",minPrice:10,maxPrice:30},{name:"Mezcal",minPrice:50,maxPrice:100},{name:"Rum",minPrice:20,maxPrice:50},{name:"Tequila",minPrice:5,maxPrice:30},{name:"Vodka",minPrice:15,maxPrice:30},{name:"Whiskey",minPrice:20,maxPrice:50},{name:"Beer",minPrice:1,maxPrice:5},{name:"Wine",minPrice:10,maxPrice:1e3}],f={all:e,updatePrices:function(){e.forEach(function(b){b.currentPrice=Math.floor(100*(Math.random()*(b.maxPrice-b.minPrice)+b.minPrice))/100,b.maxQuantityPurchasable=Math.floor(a.currentCash/b.currentPrice)}),d()},buyCommodity:function(b,d){var e=b.currentPrice*d;if(a.currentCash>=e){a.currentCash-=e;var f={name:b.name,purchasePrice:b.currentPrice,marketPrice:b.currentPrice,quantity:d};c(),a.inventory.push(f)}},sellCommodity:function(d){var f=b("filter")(e,d.name,!0);f.length&&(a.currentCash+=f[0].currentPrice*d.quantity),c(),a.inventory.splice(a.inventory.indexOf(d),1)}};return f}]),app.service("citySrvc",function(){var a=[{name:"Chicago"},{name:"New York"},{name:"Los Angeles"},{name:"Denver"},{name:"Detroit"},{name:"Miami"}],b={all:a};return b}),app.service("accountSrvc",["citySrvc",function(a){var b={daysLeft:31,inventory:[],currentCash:100,currentCity:"",highScores:[],gameOver:function(){this.highScores.push({score:this.currentCash}),this.currentCash=100,this.daysLeft=31,this.inventory=[]}};return b.currentCity||(b.currentCity=a.all[Math.floor(Math.random()*a.all.length)]),b}]);