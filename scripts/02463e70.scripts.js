"use strict";var app=angular.module("ngTraderApp",["ngCookies","ngResource","ngSanitize","ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/game",{templateUrl:"components/game/game.tmpl.html",controller:"gameCtrl"}).when("/nav",{templateUrl:"components/nav/nav.tmpl.html",controller:"navCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("gameCtrl",["$scope","commoditySrvc","citySrvc","accountSrvc",function(a,b,c,d){b.updatePrices(),a.commodities=b.all,a.account=d,a.cities=c.all,a.goToCity=function(a){b.updatePrices(),d.currentCity=a,d.daysLeft>0?d.daysLeft-=1:d.gameOver()},a.buyItem=function(c,e){b.buyCommodity(c,e),a.account=d},a.sellItem=function(c){b.sellCommodity(c),a.account=d},a.setMarketHoverItem=function(b){a.marketHoverItem=b.name},a.resetMarketHoverItem=function(){a.marketHoverItem=""}}]),app.controller("navCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),app.service("commoditySrvc",["accountSrvc","$filter",function(a,b){function c(){e.forEach(function(b){b.maxQuantityPurchasable=Math.floor(a.currentCash/b.currentPrice)})}function d(){a.inventory.forEach(function(a){var c=b("filter")(e,a.name,!0);c.length&&(a.marketPrice=c[0].currentPrice)})}var e=[{name:"Absinthe",basePrice:511,purchasedItems:[]},{name:"Cognac",basePrice:256,purchasedItems:[]},{name:"Gin",basePrice:32,purchasedItems:[]},{name:"Mezcal",basePrice:128,purchasedItems:[]},{name:"Rum",basePrice:16,purchasedItems:[]},{name:"Tequila",basePrice:8,purchasedItems:[]},{name:"Vodka",basePrice:4,purchasedItems:[]},{name:"Whiskey",basePrice:64,purchasedItems:[]},{name:"Beer",basePrice:2,purchasedItems:[]},{name:"Wine",basePrice:1024,purchasedItems:[]}],f={normalRange:20,specialRange:40},g=0,h={all:e,updatePrices:function(){var b,c=e[Math.floor(Math.random()*e.length)];e.forEach(function(d){b=Math.floor(2*Math.random()*f.normalRange)-f.normalRange,d.priceHigh=!1,d.name===c.name&&(b=Math.floor(2*Math.random()*f.specialRange)-f.specialRange,d.special=!0),b>0&&(d.priceHigh=!0),d.priceOffset=b,d.currentPrice=d.basePrice*(b/100)+d.basePrice,d.maxQuantityPurchasable=Math.floor(a.currentCash/d.currentPrice)}),d()},buyCommodity:function(d,f){var h=b("filter")(e,d.name,!0)[0],i=d.currentPrice*f;if(a.currentCash>=i){a.currentCash-=i;var j={name:d.name,purchasePrice:d.currentPrice,marketPrice:d.currentPrice,quantity:f,transactionID:g};c(),h.purchasedItems.push(j)}},sellCommodity:function(d){var f,g,h=b("filter")(e,d.name,!0)[0];h&&(f={itemName:d.name,profitEach:h.currentPrice-d.purchasePrice,profitTotal:(h.currentPrice-d.purchasePrice)*d.quantity,purchasePrice:d.purchasePrice,sellPrice:h.currentPrice,quantity:d.quantity},g=b("filter")(e,d.name,!0)[0],h.purchasedItems.splice(h.purchasedItems.indexOf(d),1),a.transactions.push(f),a.currentCash+=h.currentPrice*d.quantity),c()}};return h}]),app.service("citySrvc",function(){var a=[{name:"Chicago"},{name:"New York"},{name:"Los Angeles"},{name:"Denver"},{name:"Detroit"},{name:"Miami"}],b={all:a};return b}),app.service("accountSrvc",["citySrvc",function(a){var b={daysLeft:31,inventory:[],transactions:[],currentCash:100,currentCity:"",highScores:[],gameOver:function(){this.highScores.push({score:this.currentCash}),this.currentCash=100,this.daysLeft=31,this.inventory=[],this.transactions=[]}};return b.currentCity||(b.currentCity=a.all[Math.floor(Math.random()*a.all.length)]),b}]);